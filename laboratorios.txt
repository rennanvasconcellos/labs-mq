########## LABORATÓRIO 10 -->  Criação de trigger que move msg de uma fila DLQ para a fila principal ##########

- Crie o script abaixo no caminho "/tmp/move-msg-dlq.sh". 

#!/bin/bash

sleep 1

dmpmqmsg -m QM.01 -I QL.TESTE.DLQ -o QL.TESTE

- Configure permissão para execução do script 

chmod  775 /tmp/move-msg-dlq.sh

- No queue manageger QM.01 definir o processo que será executado

DEFINE PROCESS(MOVER.MSG.DLQ) APPLICID('/tmp/move-msg-dlq.sh') APPLTYPE(UNIX)

- No queue manageger QM.01 Criar fila de inicialização

DEFINE QLOCAL(INIT.QUEUE.MOVER.DLQ)

- No queue manageger QM.01 definir fila DLQ utilizando a trigger/process que move a msg para para a fila principal.

DEFINE QLOCAL(QL.TESTE.DLQ) TRIGGER TRIGTYPE(EVERY) TRIGDPTH(1) INITQ(INIT.QUEUE.MOVER.DLQ) PROCESS(MOVER.MSG.DLQ)

- Coloque uma msg de teste na fila QL.TESTE.DLQ. A msg deve ficar parada na fila .

runmqtrm -m QM.01 -q INIT.QUEUE.MOVER.DLQ

- Após ter iniciado a trigger no passo anterior repare quea msg colocada anteriormente foi movida para a fila QL.TESTE.DLQ e o promp do MQ informando a seguinte saída:

################################################################
## 5724-H72 (C) Copyright IBM Corp. 1994, 2023.                #
## IBM MQ Queue Load/Unload Utility trigger monitor started.   #
## Read    - Files:   0  Messages:1  Bytes:5                   #
## Written - Files:   0  Messages:1  Bytes:5                   #
## 06/24/2024  10:59:38 PM : End of application trigger.       #
################################################################


- Coloque novamente uma msg na fila QL.TESTE.DLQ e observe que esta novame msg será movida imediatamente para a fila QL.TESTE.DLQ e novamente a saída acima irá aparecer no log.


########## LABORATÓRIO 11 -->  Criação de trigger que executa inicia um canal sender ao cair uma msg na fila de transmissão ##########

- No queue manger QM.01 crie a fila de transmissão

DEFINE QLOCAL(QM.02) USAGE(XMITQ)

- No queue manager crie o canal  sender para o queue manager remoto QM.02

DEFINE CHANNEL(C.QM.01.QM.02) CHLTYPE(SDR) CONNAME('localhost(1415') XMITQ(QM.02)

- No queue manager remoto QM.02 crie o canal receptor

runmqsc QM.02

DEFINE CHANNEL(C.QM.01.QM.02) CHLTYPE(RCVR)

- Crie o script abaixo no caminho "/tmp/start-channel.sh". 

#!/bin/bash
QMGR="QM.01"
CHANNEL="C.QM.01.QM.02"

runmqsc $QMGR <<EOF
START CHANNEL($CHANNEL)
EOF

echo "Canal $CHANNEL iniciado!"

- Configure a permissão de execução para o script

chmod  775 /tmp/start-channel.sh

- No queue manageger QM.01 crie o processo que irá executar o script de start do canal sender

DEFINE PROCESS(INICIAR.CANAL) APPLICID('/tmp/start-channel.sh') APPLTYPE(UNIX)

- No queue manageger QM.01 crie a fila de inicialização

DEFINE QLOCAL(INIT.CHANNEL)

- No queue manageger QM.01 alter a fila de transmissão para utilizar a fila de trigger

ALTER QLOCAL(QM.02) TRIGGER TRIGTYPE(EVERY) TRIGDPTH(1) INITQ('INIT.CHANNEL') PROCESS('INICIAR.CANAL')

- No queue manageger QM.01 inicie o serviço da trigger

runmqtrm -m QM.01 -q INIT.CHANNEL

- No queue manageger QM.01 garanta que o canal sender esteja com o status inativo

- Coloque uma msg na fila de tranmissão e veja se o canal sender subiu.
